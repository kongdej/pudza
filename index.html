<!DOCTYPE html>
<html>
<head>
	<title>PUDZA Dashboard</title>

    <script src="js/jquery.js"></script>
    <script src="js/raphael-2.1.4.min.js"></script>
    <script src="js/justgage.js"></script>
	<script src="js/microgear.js"></script>

	<script>
		const APPID = "PUDZAHydro";
		const KEY = "BwBRekvWcYFkRGJ";
		const SECRET = "sDJCEcobv9l66aoB0LkaZl4HE";

		const ALIAS = "htmlgear";

		var microgear = Microgear.create({
			key: KEY,
			secret: SECRET,
			alias : ALIAS
		});

		microgear.on('message',function(topic,msg) {
			document.getElementById("data").innerHTML = topic+"--"+msg;
            if (topic == "/PUDZAHydro/nodemcu/lux") {
                g8.refresh(msg);
            }
            else {
                var vals = msg.split(",");
                g1.refresh(vals[0]);
                g2.refresh(vals[1]);
                g3.refresh(vals[2]);
                g4.refresh(vals[3]);
                g5.refresh(vals[4]);
                g6.refresh(vals[5]);
                g7.refresh(vals[6]);
            }



		});

		microgear.on('connected', function() {
			microgear.setAlias(ALIAS);
			document.getElementById("data").innerHTML = "Now I am connected with netpie...";
            microgear.subscribe("/raspipython/eccal");
            microgear.subscribe("/nodemcu/lux");
//           }
//			setInterval(function() {
//           }
//				microgear.chat("htmlgear","Hello from myself at "+Date.now());
//			},5000);
		});

		microgear.on('present', function(event) {
			console.log(event);
		});

		microgear.on('absent', function(event) {
			console.log(event);
		});

		microgear.resettoken(function(err) {
			microgear.connect(APPID);
		});
	</script>


</head>
<body>
<input type="textbox" id="ec_cal" value="2.5"></input>
<button id="cb">Calibrate EC</button>
<hr><div id="data">_____</div>
<div id="gauge8"></div>  
<div id="gauge7"></div>  
<div id="gauge1"></div>  
<div id="gauge3"></div>  
<div id="gauge2"></div>  
<div id="gauge4"></div>  
<div id="gauge5"></div>  
<div id="gauge6"></div>  


<script type="text/javascript">
    $( document ).ready(function() {
        $("#cb").click(function () {
            console.log($('#ec_cal').val());
//            microgear.chat("/plant", $("#ec_cal").value());
            microgear.publish ("/raspipython/eccal", $('#ec_cal').val());
        });
    });

    var g1 = new JustGage({
        id: "gauge1",
        value: 0,
        min: 0,
        max: 100,
        decimals:2,
        title: "Ambient Temperture",
        label:"DegC"
     });

    var g2 = new JustGage({
        id: "gauge2",
        value: 0,
        min: 0,
        max: 100,
//        counter: true,
//        formatNumber:true,
        donut: true,
        title: "Ambient Humidity",
        label:"%"
     });
     var g3 = new JustGage({
        id: "gauge3",
        value: 0,
        min: 0,
        max: 100,
        decimals:2,
        title: "Water Temperture",
        label:"DegC"
     });

     var g4 = new JustGage({
        id: "gauge4",
        value: 0,
        min: 0,
        max: 100,
        decimals:2,
        donut: true,
        title: "Soil Moisture",
        label:"%"
     });
     var g5 = new JustGage({
        id: "gauge5",
        value: 0,
        min: 0,
        max: 100,
        decimals:2,
        donut: true,
        title: "Rain",
        label:"%"
     });
     var g6 = new JustGage({
        id: "gauge6",
        value: 0,
        min: 0,
        max: 10,
        decimals:2,
//        donut: true,
        title: "Flow Rate",
        label:"L/min"
     });

     var g7 = new JustGage({
        id: "gauge7",
        value: 0,
        min: 0,
        max: 10,
        decimals:2,
//        donut: true,
        title: "EC",
        label:"mS/cm"
     });

     var g8 = new JustGage({
        id: "gauge8",
        value: 0,
        min: 0,
        max: 65365,
//        decimals:2,
//        donut: true,
        title: "Light",
        label:"Lux"
     });
</script>
</body>
</html>
<!-- Note
Sensors

INPUT
	- ambient temperature dht21
	- ambient Humidity dht21
	- water temperature
	- EC
	- ambient light
	- water flow 
	- rain
	- soil humidity
	- motion sensor

OUTPUT
	- relay

-->